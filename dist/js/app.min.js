"use strict";function viewModel(){function e(){u.geocode({address:c.location},function(e,o){e=e[0],o==google.maps.GeocoderStatus.OK?(t(e.geometry.location),i(e.geometry.location)):alert("Geocode was not successful for the following reason: "+o)})}function t(e){m.setCenter(e)}function i(e){var t={location:e,radius:2e4,types:["cafe"]},i=new google.maps.places.PlacesService(m);i.nearbySearch(t,function(e,t){if(t==google.maps.places.PlacesServiceStatus.OK)for(var i=0;i<e.length;i++)o(e[i]),c.isListVisible(e.length>0?!0:!1)})}function o(e){var t="https://api.foursquare.com/v2/venues/search?v=20150402",i="&client_id=GLWBEF0IKJ3IVN3QC01QKS4E505PT5HJWC1PTVMADLQTYMKR&client_secret=IMHT302C2W2IRRV0IOSTZDAN5M0I34Q1HNBTIPLNHEUX5ZXW",o="&intent=match&limit=1&ll="+e.geometry.location.k+","+e.geometry.location.D,r="&query="+e.name,l=t+i+"&v=20130815&venuePhotos=1"+o+r;$.ajax({url:l,success:function(t){var i=t.response.venues[0];c.items.push({id:e.id,name:e.name,address:a(e.vicinity),phone:n(i.contact),rating:e.rating,fsURL:"https://foursquare.com/v/"+i.name+"/"+i.id,marker:s(e)})},error:function(){c.items.push({id:e.id,name:e.name,address:a(e.vicinity),phone:"foursquare: Data Not Available",rating:e.rating,fsURL:"https://foursquare.com/",marker:s(e)})}})}function n(e){return e.formattedPhone?e.formattedPhone:"No Phone Available"}function a(e){var t=e.indexOf(","),i=e.slice(0,t)+".";return i}function s(e){var t=new google.maps.Marker({position:e.geometry.location,title:e.name,map:m,icon:new google.maps.MarkerImage(e.icon,null,null,null,new google.maps.Size(30,30))});return google.maps.event.addListener(t,"click",function(){var t=ko.utils.arrayFirst(c.items(),function(t){return t.id===e.id});c.selectItem(t)}),t}function r(e){d&&d.close(),e.id&&(document.getElementById(e.id).scrollIntoView(),d.setContent(l(e)),d.open(m,e.marker))}function l(e){var t='<div class="item-infowindow"><div class="pull-left"><strong>'+e.name+'</strong></div><div class="text-right"><a href="'+e.fsURL+'" target="_blank"><i class="fa fa-lg fa-foursquare"></i></a></div><div>'+e.address+"</div><div>"+e.phone+"</div></div>";return t}var c=this,m=new google.maps.Map(document.getElementById("map-canvas"),{zoom:12,disableDefaultUI:!0}),u=new google.maps.Geocoder,d=new google.maps.InfoWindow({content:""});google.maps.event.addListener(d,"closeclick",function(){c.selectItem(c.selectedItem())}),c.location="Birmingham, AL",c.filter=ko.observable(""),c.isListVisible=ko.observable(!1),c.items=ko.observableArray([]),c.selectedItem=ko.observable({}),c.itemsToShow=ko.pureComputed(function(){var e=this.filter().toLowerCase();if(""===e){for(var t=0;t<c.items().length;t++)c.items()[t].marker.setVisible(!0);return c.items()}return ko.utils.arrayFilter(c.items(),function(t){return t.marker.setVisible(t.name.toLowerCase().indexOf(e)>=0?!0:!1),t.name.toLowerCase().indexOf(e)>=0})},this),c.toggleList=function(){c.isListVisible(c.isListVisible()?!1:!0)},c.selectItem=function(e){c.selectedItem().id?c.selectedItem().id==e.id?(e.marker.setAnimation(null),e={}):(c.selectedItem().marker.setAnimation(null),e.marker.setAnimation(google.maps.Animation.BOUNCE)):e.marker.setAnimation(google.maps.Animation.BOUNCE),r(e),c.selectedItem(e)},e()}$(function(){ko.applyBindings(new viewModel)});